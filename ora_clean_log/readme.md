| 版本 | 时间     | 作者     | 更新内容                                                  |
| ---- | -------- | -------- | --------------------------------------------------------- |
| v1   | 20200318 | troy xie |                                                           |
| v2   | 20200403 | troy xie | 增加了audit文件删除内容，并支持多版本、多用户             |
| v3   | 20200409 | troy     | 修复了直接上传不能执行bug，以及trace文件不能正常删除的bug |

1 数据库版本限制:

11g/19c，单实例，rac都可

服务器平台 linux

前提要求：要求实例的trace文件，必须要在$ORACLE_BASE子目录下



2 实现功能如下：

2.1 清理所有实例，所有监听下trc trm xml文件，可以手动输入时间。

2.2 清理所有实例的audit文件,手动输入时间控制

2.3 清理所有监听的listener.log ，删除所有的listener.log。

2.4 会将删除前后的df -h df-i 信息输入到一个log文件中。



tips: 

1 脚本中使用adrci获取路径，adrci下所有的日志路径（无论实例、监听是否启动），都会清理，由于使用的是adrci，所以10g不支持

2 audit文件删除脚本只删除启动的实例的audit文件，asm实例除外



3 使用

3.1 root用户下，chmod 775 脚本，并执行 sh 脚本。

tip：脚本会自动获取集群和软件的用户，即便是非常规的命名，比如ora11g/grid11g这种用户

3.2 提示用户输入一个时间，单位天，表示删除该天数前的文件

 



修复记录：

1 脚本没有从windows格式转化为unix模式（可通过ue，notepad++转化)，所以上传之后执行会报错

2 因为adrci使用的时候，有的环境需要先指定adr base ,否则base dir为空，脚本中添加了手动指定basedir的部分。











